---
import BaseLayout from "../layouts/BaseLayout.astro";
import prisma from "../lib/prisma";
import { BookingWidget } from "../components/BookingWidget";

// Fetch services and settings from DB
const services = await prisma.service.findMany({
    where: { active: true },
    orderBy: { sortOrder: "asc" },
});

const settings = await prisma.settings.findUnique({
    where: { id: "main" },
});

const businessName = settings?.businessName || "AutoSpa";

// Prepare data for React component
const servicesData = services.map((s) => ({
    id: s.id,
    name: s.name,
    description: s.description,
    price: Number(s.price),
    duration: s.duration,
}));

const settingsData = {
    businessName: settings?.businessName || "AutoSpa",
    whatsappNumber: settings?.whatsappNumber || "+595991234567",
    openTime: settings?.openTime || "08:00",
    closeTime: settings?.closeTime || "18:00",
    slotDuration: settings?.slotDuration || 30,
    workingDays: settings?.workingDays?.split(",").map(Number) || [
        1, 2, 3, 4, 5, 6,
    ],
    welcomeMessage: settings?.welcomeMessage || "¬°Gracias por tu reserva!",
    currency: settings?.currency || "PYG",
};
---

<BaseLayout title={`Reserva tu cita - ${businessName}`}>
    <div
        class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900"
    >
        <!-- Hero Section -->
        <header class="relative overflow-hidden">
            <!-- Animated background -->
            <div class="absolute inset-0">
                <div
                    class="absolute inset-0 bg-[url('/hero-pattern.svg')] opacity-20"
                >
                </div>
                <div
                    class="absolute top-20 left-10 w-72 h-72 bg-primary-500/30 rounded-full blur-3xl animate-pulse"
                >
                </div>
                <div
                    class="absolute bottom-20 right-10 w-96 h-96 bg-cyan-500/20 rounded-full blur-3xl animate-pulse"
                    style="animation-delay: 1s;"
                >
                </div>
            </div>

            <nav class="relative z-10 container mx-auto px-4 py-6">
                <div class="flex items-center justify-center">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-12 h-12 bg-gradient-to-br from-primary-400 to-primary-600 rounded-xl flex items-center justify-center shadow-lg shadow-primary-500/30"
                        >
                            <span class="text-2xl">üöó</span>
                        </div>
                        <span class="text-2xl font-bold text-white"
                            >{businessName}</span
                        >
                    </div>
                </div>
            </nav>

            <div
                class="relative z-10 container mx-auto px-4 py-12 sm:py-20 text-center"
            >
                <div
                    class="inline-flex items-center gap-2 px-4 py-2 bg-white/10 backdrop-blur-sm rounded-full text-primary-300 text-sm mb-6"
                >
                    <span
                        class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"
                    ></span>
                    Reservas disponibles ahora
                </div>

                <h1
                    class="text-4xl sm:text-5xl md:text-6xl font-extrabold text-white mb-6 leading-tight"
                >
                    Tu auto merece el
                    <br class="hidden sm:block" />
                    <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-primary-400 via-cyan-400 to-primary-400 animate-pulse"
                    >
                        mejor cuidado
                    </span>
                </h1>
                <p
                    class="text-lg sm:text-xl text-slate-300 mb-10 max-w-2xl mx-auto"
                >
                    Reserva tu lavado profesional en segundos y recibe
                    confirmaci√≥n instant√°nea por WhatsApp
                </p>
                <a
                    href="#reservar"
                    class="inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-semibold rounded-2xl shadow-xl shadow-primary-500/30 hover:shadow-2xl hover:shadow-primary-500/40 hover:-translate-y-1 transition-all duration-300"
                >
                    Reservar Ahora
                    <span class="text-xl">‚Üí</span>
                </a>

                <!-- Trust indicators -->
                <div
                    class="flex flex-wrap items-center justify-center gap-6 mt-12 text-slate-400 text-sm"
                >
                    <div class="flex items-center gap-2">
                        <span class="text-emerald-400">‚úì</span> Sin esperas
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-emerald-400">‚úì</span> Confirmaci√≥n inmediata
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-emerald-400">‚úì</span> Servicio premium
                    </div>
                </div>
            </div>

            <!-- Decorative wave -->
            <div class="absolute bottom-0 left-0 right-0">
                <svg
                    viewBox="0 0 1440 120"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-full"
                >
                    <path
                        d="M0 120L60 110C120 100 240 80 360 75C480 70 600 80 720 85C840 90 960 90 1080 85C1200 80 1320 70 1380 65L1440 60V120H1380C1320 120 1200 120 1080 120C960 120 840 120 720 120C600 120 480 120 360 120C240 120 120 120 60 120H0Z"
                        fill="#f8fafc"></path>
                </svg>
            </div>
        </header>

        <!-- Services Section -->
        <section class="bg-slate-50 py-12 sm:py-16">
            <div class="container mx-auto px-4">
                <div class="text-center mb-10 sm:mb-12">
                    <span
                        class="inline-block px-4 py-1 bg-primary-100 text-primary-700 rounded-full text-sm font-medium mb-4"
                    >
                        Servicios Premium
                    </span>
                    <h2 class="text-3xl sm:text-4xl font-bold text-slate-900">
                        Nuestros Servicios
                    </h2>
                    <p class="text-slate-600 mt-3 max-w-xl mx-auto">
                        Desde lavado express hasta detailing profesional
                        completo
                    </p>
                </div>

                <div
                    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 max-w-5xl mx-auto"
                >
                    {
                        services.map((service, index) => {
                            const gradients = [
                                "from-blue-500 to-cyan-500",
                                "from-purple-500 to-pink-500",
                                "from-amber-500 to-orange-500",
                                "from-emerald-500 to-teal-500",
                                "from-rose-500 to-red-500",
                            ];
                            const icons = ["üíß", "‚ú®", "üëë", "üßπ", "üåü"];
                            const bgColors = [
                                "bg-blue-50",
                                "bg-purple-50",
                                "bg-amber-50",
                                "bg-emerald-50",
                                "bg-rose-50",
                            ];

                            return (
                                <div
                                    class="group relative bg-white rounded-2xl p-5 sm:p-6 shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 overflow-hidden"
                                    style={`animation-delay: ${index * 100}ms`}
                                >
                                    <div
                                        class={`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${gradients[index % 5]} opacity-10 rounded-full -translate-y-1/2 translate-x-1/2 group-hover:opacity-20 transition-opacity`}
                                    />

                                    <div
                                        class={`w-14 h-14 ${bgColors[index % 5]} rounded-2xl flex items-center justify-center text-3xl mb-4`}
                                    >
                                        {icons[index % 5]}
                                    </div>

                                    <h3 class="text-xl font-bold text-slate-900 mb-2">
                                        {service.name}
                                    </h3>
                                    <p class="text-slate-600 text-sm mb-4 line-clamp-2">
                                        {service.description}
                                    </p>

                                    <div class="flex items-center justify-between pt-4 border-t border-slate-100">
                                        <span
                                            class={`text-2xl font-bold bg-gradient-to-r ${gradients[index % 5]} bg-clip-text text-transparent`}
                                        >
                                            {new Intl.NumberFormat(
                                                "es-PY",
                                            ).format(
                                                Number(service.price),
                                            )}{" "}
                                            ‚Ç≤
                                        </span>
                                        <span class="text-sm text-slate-500 bg-slate-100 px-2 py-1 rounded-lg">
                                            {service.duration} min
                                        </span>
                                    </div>
                                </div>
                            );
                        })
                    }
                </div>
            </div>
        </section>

        <!-- Booking Section -->
        <section id="reservar" class="bg-white py-12 sm:py-16">
            <div class="container mx-auto px-4">
                <div class="text-center mb-10 sm:mb-12">
                    <span
                        class="inline-block px-4 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium mb-4"
                    >
                        F√°cil y r√°pido
                    </span>
                    <h2
                        class="text-3xl sm:text-4xl font-bold text-slate-900 mb-4"
                    >
                        Reserva tu Cita
                    </h2>
                    <p class="text-slate-600 max-w-xl mx-auto">
                        Selecciona el servicio, fecha y hora. Recibir√°s un
                        ticket de confirmaci√≥n por WhatsApp.
                    </p>
                </div>

                <!-- React Island for Booking -->
                <BookingWidget
                    services={servicesData}
                    settings={settingsData}
                    client:load
                />
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-slate-900 text-white py-12">
            <div class="container mx-auto px-4 text-center">
                <div
                    class="w-16 h-16 bg-gradient-to-br from-primary-400 to-primary-600 rounded-2xl flex items-center justify-center text-3xl mx-auto mb-4 shadow-lg shadow-primary-500/30"
                >
                    üöó
                </div>
                <h3 class="text-xl font-bold mb-2">{businessName}</h3>
                {
                    settings?.address && (
                        <p class="text-slate-400 mb-4">{settings.address}</p>
                    )
                }
                <div
                    class="flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4 text-slate-400 text-sm"
                >
                    <span>üìû {settings?.whatsappNumber}</span>
                    <span class="hidden sm:inline">‚Ä¢</span>
                    <span>üïê {settings?.openTime} - {settings?.closeTime}</span>
                </div>
                <p class="text-slate-600 text-sm mt-8">
                    ¬© {new Date().getFullYear()}
                    {businessName}. Todos los derechos reservados.
                </p>
            </div>
        </footer>
    </div>
</BaseLayout>
